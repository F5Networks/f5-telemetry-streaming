.. _tssystem-ref:

Telemetry System class
----------------------

The Telemetry System class sets up the system poller and optionally, the iHealth poller. Users have the option of either defining both pollers inside of the Telemetry_System class or defining them outside of the class and referencing them by name. 

The minimal declaration defines ``My_System_Minimal`` targeted to ``localhost`` on port ``8100``, using the ``http`` protocol, and the user is ``admin``.

.. code-block:: javascript
   :linenos:


   "My_System_Minimal": {
        "class": "Telemetry_System",
        "systemPoller": {
            "interval": 60
        }
    }



+----------------------------+--------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Parameter                  | Options                        |  Description/Notes                                                                                                                                                              |
+============================+================================+=================================================================================================================================================================================+
| class                      | Telemetry_System               |  **Required**. String: the class for the Telemetry System must always be ``Telemetry_System``, do not change this value.                                                        |
+----------------------------+--------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| enable                     | **true**, false                |  **Optional**. Boolean: this value enables or disables the Telemetry System and all pollers attached to it. By default it is set to ``true``.                                   |
+----------------------------+--------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| trace                      | true, **false**                |  **Optional**. Boolean: this value enables or disables tracing. By default it is set to ``false``.                                                                              |
+----------------------------+--------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| username                   |                                |  **Optional**. String: F5 BIG-IP username.                                                                                                                                      |
+----------------------------+--------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| passphrase                 |                                |  **Optional**. Object: F5 BIG-IP password. Requires ``username`` to be set.                                                                                                     |
+----------------------------+--------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| host                       | **localhost**                  |  **Optional**. String: F5 BIG-IP hostname or IP address. By default it is set to ``localhost``.                                                                                 |
+----------------------------+--------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| port                       | 0 - 65535, **8100**            |  **Optional**. Number: connection port. By default it is set to ``8100``.                                                                                                       |
+----------------------------+--------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| protocol                   | http, https                    |  **Optional**. String: HTTP protocol. By default it is set to ``http``.                                                                                                         |
+----------------------------+--------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| allowSelfSignedCert        | true, **false**                |  **Optional**. Boolean: allow to use self-signed certificates to establish HTTP connection. By default it is set to ``false``.                                                  |
+----------------------------+--------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+



.. _syspoller: 

System poller
`````````````
The system poller collects and normalizes statistics from a system, such as BIG-IP, on a configurable interval for information such as device statistics, virtual server statistics, pool statistics, individual pool member statistics, and more.

+----------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Parameter                  | Options                        |  Description/Notes                                                                                                                                                                                                                                                       |
+============================+================================+==========================================================================================================================================================================================================================================================================+
| enable                     | **true**, false                |  **Optional**. Boolean: this value enables or disables the Telemetry System and all pollers attached to it. By default it is set to ``true``.                                                                                                                            |
+----------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| trace                      | true, **false**                |  **Optional**. Boolean: this value enables or disables tracing. By default it is set to ``false``.                                                                                                                                                                       |
+----------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| interval                   | 0, 60 - 6000, **300**          |  **Optional**. Number: this value determines the polling period in seconds. By default, Telemetry Streaming collects statistics every 300 seconds. When value set to 0 then interval polling is disabled, useful when you want to configure :ref:`pullconsumer-ref`      |
+----------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| actions                    |                                |  **Optional**. Actions to be performed on the data collected by the system poller. See :doc:`data-modification` for more information on this feature.                                                                                                                    |
+----------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| endpointList               |                                |  **Optional**. Data endpoints to be collected by the system poller. See :doc:`custom-endpoints` for more information on this feature.                                                                                                                                    |
+----------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| workers                    | **5**                          |  **Optional**. Number: this value determines the number of workers to create to collect data. Affects processing of simultaneous requests to device. By default it is set to ``5``. Minimal value is ``1``.                                                              |
+----------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| chunkSize                  | **30**                         |  **Optional**. Number: this value determines The maximum number of items to fetch at a time for a given endpoint. Requests with reduced response size can help improve CPU/memory utilization. By default it is set to ``30``. Minimal value is ``1``.                   |
+----------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| httpAgentOpts              |                                |  **Optional**. Determines the configuration for HTTP transport layer. See :ref:`http-agent-options` for more information on this feature.                                                                                                                                |
+----------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+



.. _ihealthpoller:

iHealth poller
``````````````
The iHealth poller creates a QKView on the target system, downloads it to the host on which Telemetry Streaming is running, uploads QKView to F5 iHealth Service from the host on which TS is running, and fetches the F5 iHealth Service QKView analysis. For more information on iHealth see the documentation on |ihealth|. To see an example of a declaration with referenced pollers instead of inline, see :ref:`referencedpollers`.

.. IMPORTANT:: The iHealth Poller must be attached to a Telemetry_System class, otherwise the iHealth Poller will be disabled.

.. IMPORTANT:: Beginning with BIG-IP Telemetry Streaming version 1.36.0 BIG-IP Telemetry Streaming requires users to follow instructions described in `K000135241 <https://my.f5.com/manage/s/article/K000135241>`_ to obtain credentials to access F5 iHealth Service API.

iHealth Poller minimal declaration:

.. code-block:: javascript
   :linenos:


    "My_System_Minimal": {
        "class": "Telemetry_System",
        "iHealthPoller": {
            "username": "test_username_id",
            "passphrase": {
                "cipherText": "test_passphrase_id"
            },
            "interval": {
                "timeWindow": {
                    "start": "23:15",
                    "end":   "02:15"
                }
            }
        }
    }

iHealth Poller full declaration:

.. code-block:: javascript
   :linenos:

   "My_System_Minimal": {
        "class": "Telemetry_System",
        "iHealthPoller": {
            "username": "test_username_id",
            "passphrase": {
                "cipherText": "test_passphrase_id"
            },
            "proxy": {
                "host": "127.0.0.1",
                "protocol": "http",
                "port": 80,
                "username": "test_username_proxy",
                "passphrase": {
                    "cipherText": "test_passphrase_proxy"
                }
            },
            "interval": {
                "timeWindow": {
                    "start": "23:15",
                    "end":   "06:15"
                },
                "frequency": "monthly",
                "day": "5"
            }
        }
   }


+----------------------------+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Parameter                  | Options                        |  Description/Notes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
+============================+================================+===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
| class                      | Telemetry_iHealth_Poller       |  **Required**. String: The class for the iHealth poller must always be ``Telemetry_iHealth_Poller``, do not change this value.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
+----------------------------+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| enable                     | **true**, false                |  **Optional**. Boolean: this value enables or disables the iHealth Poller. By default it is set to ``true``.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
+----------------------------+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| trace                      | true, **false**                |  **Optional**. Boolean: this value enables or disables tracing. By default it is set to ``false``.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
+----------------------------+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| username                   |                                |  **Required**. String: use your F5 iHealth Service Client ID.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
+----------------------------+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| passphrase                 |                                |  **Required**. Object: use your F5 iHealth Service Client Secret.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
+----------------------------+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| proxy                      |                                |  **Optional**. Object: this value allows you to send QKView to F5 iHealth Service via proxy.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
+----------------------------+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| interval                   |                                |  **Required**. Object: this value determines the polling period in seconds.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
+----------------------------+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| interval.timeWindow        |                                |  **Required**. Object: this value sets the operating window.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
+----------------------------+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| interval.timeWindow.start  |                                |  **Required**. String: this value sets the iHealth poller operating window start time in the format ``HH:MM``. The minimum difference between start and end time is 120 minutes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
+----------------------------+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| interval.timeWindow.end    |                                |  **Required**. String: this value sets the iHealth poller operating window end time in the format ``HH:MM``. The minimum difference between start and end is 120 minutes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
+----------------------------+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| interval.frequency         | **daily**, weekly, monthly     |  **Optional**. String: this value sets the iHealth poller operating interval. The default value is ``daily``.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
+----------------------------+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| interval.day               | 0-7 or Monday-Sunday           |  Integer or string: this value is required only when ``interval.frequency`` is ``weekly`` or ``monthly``. When ``interval.frequency`` is ``weekly``, then ``interval.day`` represents a day of the week. The value can be a string from ``Monday`` to ``Sunday`` (lowercase will work) or the value can be an integer from ``0`` to ``7`` where both ``0`` and ``7`` represent Sunday. When ``interval.frequency`` is ``monthly`` then ``interval.day`` represents the day of the month. The value should be an integer from ``1`` to ``31``. If ``interval.day`` is ``31`` and the last day of the month is 28, 29, or 30, then the actual last day of the month will be used.   |
+----------------------------+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+



.. |ihealth| raw:: html

   <a href="https://devcentral.f5.com/wiki/iHealth.HomePage.ashx" target="_blank">DevCentral</a>